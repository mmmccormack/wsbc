
<!DOCTYPE html>
<html lang=en>
    <link rel="stylesheet" href="./style.css">
<head>
<title>Using Drag and Drop API to copy and move elements</title>
<!-- 
   This example demonstrates using various HTML Drag and Drop interfaces including:
   * Global "draggable" attribute
   * Event handlers for dragstart, dragover and drop
   * Global event handlers for ondragstart, ondragover and ondrop
   * Using the DataTransfer interface to copy and move elements (<div>)
-->
<style>
  .lineup, .roster {
    border: 5px solid blue;
    width: 150px;
    height: 80vh;
  }
  .lineup-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    width: 300px;
    margin: 0 auto;
  }
</style>

</head>
<body>
<h1>Drag and Drop Lineup</h1>
<div class="lineup-container">
    <h3>Roster</h3>
    <h3>Lineup</h3>
    <div class="roster" id="roster">
        <div draggable="true" class="box switch" id="gabe">gabe</div>
        <div draggable="true" class="box right" id="jake">jake</div>
        <div draggable="true" class="box left" id="julie">julie</div>
        <div draggable="true" class="box right" id="joe">joe</div>
        <div draggable="true" class="box switch" id="kraemer">kraemer</div>
        <div draggable="true" class="box right" id="kristy">kristy</div>
        <div draggable="true" class="box right" id="pat">pat</div>
        <div draggable="true" class="box right" id="tyler">tyler</div>
        <div draggable="true" class="box right" id="shawna">shawna</div>
        <div draggable="true" class="box right" id="steve">steve</div>
        <div draggable="true" class="box right" id="warren">warren</div>
        <div draggable="true" class="box right" id="taylor">taylor</div>
    </div>
     <div class="lineup" id="lineup">

     </div>
</div>

</body>
<script>

const roster = {
        'kristy': 'f',
        'julie': 'f',
        'shawna': 'f',
        'taylor': 'f',
        'pat': 'm',
        'tyler': 'm',
        'steve': 'm',
        'gabe': 'm',
        'warren': 'm',
        'jake': 'm',
        'kraemer': 'm',
        'joe': 'm'
    }
    const stances = {
        'kristy': 'right',
        'julie': 'left',
        'shawna': 'right',
        'taylor': 'right',
        'pat': 'right',
        'tyler': 'right',
        'steve': 'right',
        'warren': 'right',
        'jake': 'right',
        'kraemer': 'switch',
        'joe': 'right',
        'gabe': 'switch',
    }

    function handleDragStart(ev) {
        dragSrcEl = ev.target;
     // Change the source element's background color to signify drag has started
     ev.target.classList.add('over');
     // Add the id of the drag source element to the drag data payload so
     // it is available when the drop event is fired
     ev.dataTransfer.setData("text", ev.target.id);
     // Tell the browser both copy and move are possible
     ev.effectAllowed = "move";
    }
    function handleDragOver(ev) {
     // Change the target element's border to signify a drag over event
     // has occurred
     ev.preventDefault();
    }
    function handleDrop(ev) {
        ev.preventDefault();
        // Get the id within the drag source element
        var id = ev.dataTransfer.getData("text");
        if (dragSrcEl.parentElement.id === "lineup") {
            if (dragSrcEl !== ev.target) {
                dragSrcEl.innerHTML = ev.target.innerHTML;
                dragSrcEl.id = ev.target.id;
                ev.target.innerHTML = ev.dataTransfer.getData('text');
                ev.target.id = ev.dataTransfer.getData('text');
            }
        }
        // Only Move the element if the source and destination ids are both "move"
        if (ev.target.id == "lineup") {
            const batterAddedToLineup = document.getElementById(id);
            ev.target.appendChild(batterAddedToLineup);
        }

        

    }
    function handleDragEnd(ev) {
      // Restore source's border
    //   ev.target.classList.remove('over');
    const lineupItems = document.querySelectorAll('.lineup .box');
        lineupItems.forEach( item => {
            item.classList.remove('red', 'left', 'right', 'switch', 'over');
            item.classList.add(stances[item.innerText]);
            console.log(item.classList)
        })
        if (lineupItems.length >= 3) {
            for (let item = 0; item < lineupItems.length; item++) {
                let batterDragged = lineupItems[item];
                let batterAhead; 
                if (batterDragged.previousElementSibling == null) {
                    batterAhead = lineupItems[lineupItems.length - 1];
                } else {
                    batterAhead = batterDragged.previousElementSibling;
                }
                let batterBehind;
                if (batterDragged.nextElementSibling == null) {
                    batterBehind = lineupItems[0];
                } else {
                    batterBehind = batterDragged.nextElementSibling;
                }
                if (roster[batterAhead.textContent] === 'm' && roster[batterDragged.textContent] === 'm' && roster[batterBehind.textContent] === 'm') {
                    batterAhead.classList.add('red');
                    batterDragged.classList.add('red');
                    batterBehind.classList.add('red');
                }
            }
        }
        return false;
    }
    
    const items = document.querySelectorAll('.roster .box');
        items.forEach( item => {
            item.addEventListener('dragstart', handleDragStart);
            // item.addEventListener('dragover', handleDragOver);
            // item.addEventListener('dragenter', handleDragEnter);
            // item.addEventListener('dragleave', handleDragLeave);
            item.addEventListener('dragend', handleDragEnd);
            // item.addEventListener('drop', handleDrop);
        });
    
        document.querySelector('.lineup').addEventListener('dragover', handleDragOver);
        document.querySelector('.roster').addEventListener('dragover', handleDragOver);
        document.querySelector('.lineup').addEventListener('drop', handleDrop);
        document.querySelector('.roster').addEventListener('drop', handleDrop);
    
    </script>
</html>
